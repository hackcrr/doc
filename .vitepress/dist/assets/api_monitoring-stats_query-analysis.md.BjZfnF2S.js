import{_ as p,I as o,c as e,o as t,j as n,J as r,aj as c,a}from"./chunks/framework.e3UxQEvm.js";const C=JSON.parse('{"title":"æŸ¥è¯¢åˆ†æç»Ÿè®¡","description":"","frontmatter":{},"headers":[],"relativePath":"api/monitoring-stats/query-analysis.md","filePath":"api/monitoring-stats/query-analysis.md","lastUpdated":1764654523000}'),F={name:"api/monitoring-stats/query-analysis.md"};function D(y,s,i,u,b,d){const l=o("ApiEndpoint");return t(),e("div",null,[s[0]||(s[0]=n("h1",{id:"æŸ¥è¯¢åˆ†æç»Ÿè®¡",tabindex:"-1"},[a("æŸ¥è¯¢åˆ†æç»Ÿè®¡ "),n("a",{class:"header-anchor",href:"#æŸ¥è¯¢åˆ†æç»Ÿè®¡","aria-label":"Permalink to â€œæŸ¥è¯¢åˆ†æç»Ÿè®¡â€"},"â€‹")],-1)),s[1]||(s[1]=n("h2",{id:"ç«¯ç‚¹ä¿¡æ¯",tabindex:"-1"},[a("ç«¯ç‚¹ä¿¡æ¯ "),n("a",{class:"header-anchor",href:"#ç«¯ç‚¹ä¿¡æ¯","aria-label":"Permalink to â€œç«¯ç‚¹ä¿¡æ¯â€"},"â€‹")],-1)),r(l,{method:"GET",path:"/stats/query-analysis"}),s[2]||(s[2]=c(`<p>è·å–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ç›‘æ§å’Œæ…¢æŸ¥è¯¢åˆ†æä¿¡æ¯ã€‚</p><h2 id="æƒé™è¦æ±‚" tabindex="-1">æƒé™è¦æ±‚ <a class="header-anchor" href="#æƒé™è¦æ±‚" aria-label="Permalink to â€œæƒé™è¦æ±‚â€">â€‹</a></h2><ul><li><code>monitoring</code> æƒé™</li><li>å¯¹ç›®æ ‡æ•°æ®åº“çš„ <code>read</code> æƒé™</li></ul><h2 id="è¯·æ±‚" tabindex="-1">è¯·æ±‚ <a class="header-anchor" href="#è¯·æ±‚" aria-label="Permalink to â€œè¯·æ±‚â€">â€‹</a></h2><h3 id="è¯·æ±‚å¤´" tabindex="-1">è¯·æ±‚å¤´ <a class="header-anchor" href="#è¯·æ±‚å¤´" aria-label="Permalink to â€œè¯·æ±‚å¤´â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>å¤´éƒ¨</th><th>å€¼</th><th>å¿…å¡«</th></tr></thead><tbody><tr><td><code>Authorization</code></td><td><code>Bearer your_api_key</code></td><td>æ˜¯</td></tr></tbody></table><h3 id="æŸ¥è¯¢å‚æ•°" tabindex="-1">æŸ¥è¯¢å‚æ•° <a class="header-anchor" href="#æŸ¥è¯¢å‚æ•°" aria-label="Permalink to â€œæŸ¥è¯¢å‚æ•°â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>å¿…å¡«</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>db_name</code></td><td>string</td><td>å¦</td><td>ç©º</td><td>æŒ‡å®šæ•°æ®åº“åç§°ï¼Œè¿‡æ»¤ç‰¹å®šæ•°æ®åº“çš„æŸ¥è¯¢</td></tr><tr><td><code>limit</code></td><td>integer</td><td>å¦</td><td>10</td><td>è¿”å›çš„æ…¢æŸ¥è¯¢æ•°é‡é™åˆ¶</td></tr></tbody></table><h2 id="å“åº”" tabindex="-1">å“åº” <a class="header-anchor" href="#å“åº”" aria-label="Permalink to â€œå“åº”â€">â€‹</a></h2><h3 id="æˆåŠŸå“åº”" tabindex="-1">æˆåŠŸå“åº” <a class="header-anchor" href="#æˆåŠŸå“åº”" aria-label="Permalink to â€œæˆåŠŸå“åº”â€">â€‹</a></h3><p><strong>çŠ¶æ€ç :</strong> <code>200 OK</code></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">timestamp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">2024-01-20T15:30:00</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">query_stats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">total_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 15000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">slow_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 23</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">queries_per_second</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 45.7</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">select_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 12000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">insert_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1500</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">update_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 800</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">delete_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 700</span></span>
<span class="line"><span style="color:#89DDFF;">  },</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">slow_queries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    {</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">database</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">users_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">query_time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 5.234</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">lock_time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0.123</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">rows_sent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">rows_examined</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 50000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">sql_text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">SELECT * FROM large_table WHERE status = &#39;active&#39;...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">start_time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">2024-01-20T14:25:00</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;">  ],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">connection_stats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">total_connections</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 15</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">active_connections</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">max_used_connections</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 25</span></span>
<span class="line"><span style="color:#89DDFF;">  },</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">active_connections</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    {</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 123</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">api_user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">host</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">192.168.1.100:54321</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">users_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">command</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Query</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 5</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Sending data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">info</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">SELECT * FROM users WHERE age &gt; 30</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—æœªå¯ç”¨å“åº”" tabindex="-1">æ…¢æŸ¥è¯¢æ—¥å¿—æœªå¯ç”¨å“åº” <a class="header-anchor" href="#æ…¢æŸ¥è¯¢æ—¥å¿—æœªå¯ç”¨å“åº”" aria-label="Permalink to â€œæ…¢æŸ¥è¯¢æ—¥å¿—æœªå¯ç”¨å“åº”â€">â€‹</a></h3><p><strong>çŠ¶æ€ç :</strong> <code>200 OK</code></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">timestamp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">2024-01-20T15:30:00</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">slow_log_available</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> false,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">slow_log_error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">(1054, </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Unknown column &#39;sql_text&#39; in &#39;field list&#39;</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">active_connections</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#BABED8;">...</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">connection_stats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span><span style="color:#BABED8;">...</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="å“åº”å­—æ®µè¯´æ˜" tabindex="-1">å“åº”å­—æ®µè¯´æ˜ <a class="header-anchor" href="#å“åº”å­—æ®µè¯´æ˜" aria-label="Permalink to â€œå“åº”å­—æ®µè¯´æ˜â€">â€‹</a></h3><h4 id="åŸºæœ¬ä¿¡æ¯" tabindex="-1">åŸºæœ¬ä¿¡æ¯ <a class="header-anchor" href="#åŸºæœ¬ä¿¡æ¯" aria-label="Permalink to â€œåŸºæœ¬ä¿¡æ¯â€">â€‹</a></h4><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>timestamp</code></td><td>string</td><td>ç»Ÿè®¡ç”Ÿæˆæ—¶é—´æˆ³</td></tr><tr><td><code>slow_log_available</code></td><td>boolean</td><td>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¯ç”¨</td></tr><tr><td><code>slow_log_error</code></td><td>string</td><td>æ…¢æŸ¥è¯¢æ—¥å¿—é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœä¸å¯ç”¨ï¼‰</td></tr></tbody></table><h4 id="æŸ¥è¯¢ç»Ÿè®¡" tabindex="-1">æŸ¥è¯¢ç»Ÿè®¡ <a class="header-anchor" href="#æŸ¥è¯¢ç»Ÿè®¡" aria-label="Permalink to â€œæŸ¥è¯¢ç»Ÿè®¡â€">â€‹</a></h4><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>total_queries</code></td><td>integer</td><td>æ€»æŸ¥è¯¢æ¬¡æ•°</td></tr><tr><td><code>slow_queries</code></td><td>integer</td><td>æ…¢æŸ¥è¯¢æ¬¡æ•°</td></tr><tr><td><code>queries_per_second</code></td><td>number</td><td>æ¯ç§’æŸ¥è¯¢æ•°</td></tr><tr><td><code>select_queries</code></td><td>integer</td><td>SELECT æŸ¥è¯¢æ¬¡æ•°</td></tr><tr><td><code>insert_queries</code></td><td>integer</td><td>INSERT æŸ¥è¯¢æ¬¡æ•°</td></tr><tr><td><code>update_queries</code></td><td>integer</td><td>UPDATE æŸ¥è¯¢æ¬¡æ•°</td></tr><tr><td><code>delete_queries</code></td><td>integer</td><td>DELETE æŸ¥è¯¢æ¬¡æ•°</td></tr></tbody></table><h4 id="æ…¢æŸ¥è¯¢è¯¦æƒ…" tabindex="-1">æ…¢æŸ¥è¯¢è¯¦æƒ… <a class="header-anchor" href="#æ…¢æŸ¥è¯¢è¯¦æƒ…" aria-label="Permalink to â€œæ…¢æŸ¥è¯¢è¯¦æƒ…â€">â€‹</a></h4><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>database</code></td><td>string</td><td>æŸ¥è¯¢æ‰€åœ¨çš„æ•°æ®åº“åç§°</td></tr><tr><td><code>query_time</code></td><td>number</td><td>æŸ¥è¯¢æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰</td></tr><tr><td><code>lock_time</code></td><td>number</td><td>é”ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰</td></tr><tr><td><code>rows_sent</code></td><td>integer</td><td>è¿”å›ç»™å®¢æˆ·ç«¯çš„è¡Œæ•°</td></tr><tr><td><code>rows_examined</code></td><td>integer</td><td>æœåŠ¡å™¨æ‰«æçš„è¡Œæ•°</td></tr><tr><td><code>sql_text</code></td><td>string</td><td>SQLæŸ¥è¯¢è¯­å¥ï¼ˆæˆªæ–­æ˜¾ç¤ºï¼‰</td></tr><tr><td><code>start_time</code></td><td>string</td><td>æŸ¥è¯¢å¼€å§‹æ—¶é—´æˆ³</td></tr></tbody></table><h4 id="è¿æ¥ç»Ÿè®¡" tabindex="-1">è¿æ¥ç»Ÿè®¡ <a class="header-anchor" href="#è¿æ¥ç»Ÿè®¡" aria-label="Permalink to â€œè¿æ¥ç»Ÿè®¡â€">â€‹</a></h4><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>total_connections</code></td><td>integer</td><td>å½“å‰æ€»è¿æ¥æ•°</td></tr><tr><td><code>active_connections</code></td><td>integer</td><td>æ´»è·ƒè¿æ¥æ•°</td></tr><tr><td><code>max_used_connections</code></td><td>integer</td><td>å†å²æœ€å¤§è¿æ¥æ•°</td></tr></tbody></table><h4 id="æ´»è·ƒè¿æ¥è¯¦æƒ…" tabindex="-1">æ´»è·ƒè¿æ¥è¯¦æƒ… <a class="header-anchor" href="#æ´»è·ƒè¿æ¥è¯¦æƒ…" aria-label="Permalink to â€œæ´»è·ƒè¿æ¥è¯¦æƒ…â€">â€‹</a></h4><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>id</code></td><td>integer</td><td>è¿æ¥ID</td></tr><tr><td><code>user</code></td><td>string</td><td>æ•°æ®åº“ç”¨æˆ·å</td></tr><tr><td><code>host</code></td><td>string</td><td>å®¢æˆ·ç«¯ä¸»æœºåœ°å€</td></tr><tr><td><code>db</code></td><td>string</td><td>å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</td></tr><tr><td><code>command</code></td><td>string</td><td>æ‰§è¡Œçš„å‘½ä»¤ç±»å‹</td></tr><tr><td><code>time</code></td><td>integer</td><td>å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰</td></tr><tr><td><code>state</code></td><td>string</td><td>è¿æ¥å½“å‰çŠ¶æ€</td></tr><tr><td><code>info</code></td><td>string</td><td>æ­£åœ¨æ‰§è¡Œçš„SQLè¯­å¥</td></tr></tbody></table><h2 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹" aria-label="Permalink to â€œä½¿ç”¨ç¤ºä¾‹â€">â€‹</a></h2><h3 id="curl-ç¤ºä¾‹" tabindex="-1">cURL ç¤ºä¾‹ <a class="header-anchor" href="#curl-ç¤ºä¾‹" aria-label="Permalink to â€œcURL ç¤ºä¾‹â€">â€‹</a></h3><p><strong>è·å–æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢åˆ†æ:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -X</span><span style="color:#C3E88D;"> GET</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">https://dbapi.muzilix.cn/stats/query-analysis</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">  -H</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Authorization: Bearer your_api_key</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è·å–ç‰¹å®šæ•°æ®åº“æŸ¥è¯¢åˆ†æ:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -X</span><span style="color:#C3E88D;"> GET</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">https://dbapi.muzilix.cn/stats/query-analysis?db_name=users_db&amp;limit=20</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">  -H</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Authorization: Bearer your_api_key</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="python-ç¤ºä¾‹" tabindex="-1">Python ç¤ºä¾‹ <a class="header-anchor" href="#python-ç¤ºä¾‹" aria-label="Permalink to â€œPython ç¤ºä¾‹â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> time</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> datetime </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> datetime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">=None,</span><span style="color:#BABED8;font-style:italic;"> limit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">è·å–æŸ¥è¯¢åˆ†æç»Ÿè®¡ä¿¡æ¯</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">https://dbapi.muzilix.cn/stats/query-analysis</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    params </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> {}</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> db_name</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        params</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">db_name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> db_name</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> limit</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        params</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">limit</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> limit</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    headers </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> {</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Authorization</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;"> f</span><span style="color:#C3E88D;">&quot;Bearer </span><span style="color:#F78C6C;">{</span><span style="color:#BABED8;">api_key</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    response </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> params</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">params</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> headers</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">headers</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> analyze_slow_queries</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">åˆ†ææ…¢æŸ¥è¯¢æ€§èƒ½</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> limit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#89DDFF;"> not</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> True):</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;é”™è¯¯: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">æœªçŸ¥é”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ“Š æŸ¥è¯¢æ€§èƒ½åˆ†ææŠ¥å‘Š</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   ç”Ÿæˆæ—¶é—´: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">timestamp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æŸ¥è¯¢ç»Ÿè®¡</span></span>
<span class="line"><span style="color:#BABED8;">    query_stats </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> query_stats</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">ğŸ“ˆ æŸ¥è¯¢ç»Ÿè®¡:&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ€»æŸ¥è¯¢æ¬¡æ•°: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">total_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ…¢æŸ¥è¯¢æ¬¡æ•°: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ¯ç§’æŸ¥è¯¢æ•°: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">queries_per_second</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:.1f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   SELECT æŸ¥è¯¢: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">select_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   INSERT æŸ¥è¯¢: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">insert_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   UPDATE æŸ¥è¯¢: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">update_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   DELETE æŸ¥è¯¢: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">delete_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ…¢æŸ¥è¯¢åˆ†æ</span></span>
<span class="line"><span style="color:#BABED8;">    slow_queries </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> [])</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> slow_queries</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">âš ï¸  æ…¢æŸ¥è¯¢åˆ†æ (å…± </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">slow_queries</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> ä¸ª):&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        for</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> query </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">slow_queries</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 1</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">i</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">. æ•°æ®åº“: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">database</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;      æ‰§è¡Œæ—¶é—´: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:.3f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">s&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;      é”ç­‰å¾…: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lock_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:.3f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">s&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;      æ‰«æ/è¿”å›: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rows_examined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rows_sent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;      SQL: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sql_text</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][:</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">...&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;      æ—¶é—´: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">start_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">âœ… æœªå‘ç°æ…¢æŸ¥è¯¢</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # è¿æ¥ç»Ÿè®¡</span></span>
<span class="line"><span style="color:#BABED8;">    conn_stats </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">connection_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> conn_stats</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">ğŸ”— è¿æ¥ç»Ÿè®¡:&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ€»è¿æ¥æ•°: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">total_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ´»è·ƒè¿æ¥: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æœ€å¤§è¿æ¥: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">max_used_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ´»è·ƒè¿æ¥</span></span>
<span class="line"><span style="color:#BABED8;">    active_conns </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> [])</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> active_conns</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">ğŸ”„ æ´»è·ƒè¿æ¥ (å…± </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">active_conns</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> ä¸ª):&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        for</span><span style="color:#BABED8;"> conn </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> active_conns</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">            if</span><span style="color:#BABED8;"> conn</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#F78C6C;"> 10</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">  # é•¿æ—¶é—´è¿è¡Œçš„è¿æ¥</span></span>
<span class="line"><span style="color:#82AAFF;">                print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   âš ï¸ è¿æ¥ </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> è¿è¡Œ </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">s: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">info</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> monitor_query_performance</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> threshold_seconds</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">ç›‘æ§æŸ¥è¯¢æ€§èƒ½å¹¶è®¾ç½®å‘Šè­¦</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    slow_queries </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> [])</span></span>
<span class="line"><span style="color:#BABED8;">    critical_slow_queries </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#BABED8;">        q </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> q </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> slow_queries </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        if</span><span style="color:#BABED8;"> q</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#BABED8;"> threshold_seconds</span></span>
<span class="line"><span style="color:#89DDFF;">    ]</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> critical_slow_queries</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;ğŸš¨ æ€§èƒ½å‘Šè­¦: å‘ç° </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">critical_slow_queries</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> ä¸ªè¶…è¿‡ </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">threshold_seconds</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">ç§’ çš„æ…¢æŸ¥è¯¢&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        for</span><span style="color:#BABED8;"> query </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> critical_slow_queries</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">            print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   - </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:.2f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">s: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sql_text</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][:</span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">...&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # è¿æ¥æ± ä½¿ç”¨ç‡å‘Šè­¦</span></span>
<span class="line"><span style="color:#BABED8;">    conn_stats </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">connection_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#BABED8;">    total_conns </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> conn_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">total_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    active_conns </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> conn_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> total_conns </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;"> and</span><span style="color:#BABED8;"> active_conns </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> total_conns </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> 0.8</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;ğŸš¨ è¿æ¥æ± å‘Šè­¦: ä½¿ç”¨ç‡ </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">active_conns</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">total_conns</span><span style="color:#C792EA;">:.1%</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> performance_trend_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> interval_minutes</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">æ€§èƒ½è¶‹åŠ¿åˆ†æ</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿åˆ†æä¸­...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ¨¡æ‹Ÿå¤šæ¬¡é‡‡æ ·åˆ†æè¶‹åŠ¿</span></span>
<span class="line"><span style="color:#BABED8;">    samples </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    for</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> range</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">):</span><span style="color:#676E95;font-style:italic;">  # é‡‡æ ·6æ¬¡</span></span>
<span class="line"><span style="color:#BABED8;">        data </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#BABED8;">        query_stats </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#BABED8;">        slow_count </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> []))</span></span>
<span class="line"><span style="color:#BABED8;">        active_conns </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">connection_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {}).</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#BABED8;">        samples</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#89DDFF;">            &#39;</span><span style="color:#C3E88D;">timestamp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">timestamp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">            &#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> slow_count</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> active_conns</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &#39;</span><span style="color:#C3E88D;">qps</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">queries_per_second</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">        })</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        if</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;"> 5</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">  # ä¸æ˜¯æœ€åä¸€æ¬¡é‡‡æ ·</span></span>
<span class="line"><span style="color:#BABED8;">            time</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">interval_minutes </span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;"> 60</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # åˆ†æè¶‹åŠ¿</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">\\n</span><span style="color:#C3E88D;">ğŸ“Š è¶‹åŠ¿åˆ†æç»“æœ:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    first </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> samples</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    last </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> samples</span><span style="color:#89DDFF;">[-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    slow_change </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> last</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> -</span><span style="color:#BABED8;"> first</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    conn_change </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> last</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> -</span><span style="color:#BABED8;"> first</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">active_connections</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    qps_change </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> last</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">qps</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> -</span><span style="color:#BABED8;"> first</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">qps</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ…¢æŸ¥è¯¢å˜åŒ–: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">slow_change</span><span style="color:#C792EA;">:+d</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ´»è·ƒè¿æ¥å˜åŒ–: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">conn_change</span><span style="color:#C792EA;">:+d</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   QPS å˜åŒ–: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">qps_change</span><span style="color:#C792EA;">:+.1f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    API_KEY </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">your_api_key</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # åŸºæœ¬æŸ¥è¯¢åˆ†æ</span></span>
<span class="line"><span style="color:#82AAFF;">    analyze_slow_queries</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">API_KEY</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">production_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ€§èƒ½ç›‘æ§</span></span>
<span class="line"><span style="color:#82AAFF;">    monitor_query_performance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">API_KEY</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">production_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> threshold_seconds</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2.0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # è¶‹åŠ¿åˆ†æï¼ˆéœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # performance_trend_analysis(API_KEY, &quot;production_db&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br></div></div><h2 id="ç›‘æ§æŒ‡æ ‡è¯´æ˜" tabindex="-1">ç›‘æ§æŒ‡æ ‡è¯´æ˜ <a class="header-anchor" href="#ç›‘æ§æŒ‡æ ‡è¯´æ˜" aria-label="Permalink to â€œç›‘æ§æŒ‡æ ‡è¯´æ˜â€">â€‹</a></h2><h3 id="æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡" tabindex="-1">æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡ <a class="header-anchor" href="#æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡" aria-label="Permalink to â€œæŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡â€">â€‹</a></h3><ul><li><strong>æ…¢æŸ¥è¯¢é˜ˆå€¼</strong>: é»˜è®¤è¶…è¿‡10ç§’çš„æŸ¥è¯¢è¢«è®¤ä¸ºæ˜¯æ…¢æŸ¥è¯¢</li><li><strong>æŸ¥è¯¢ç±»å‹åˆ†å¸ƒ</strong>: åˆ†æå„ç±»æŸ¥è¯¢çš„æ¯”ä¾‹ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ</li><li><strong>QPS (Queries Per Second)</strong>: æ¯ç§’æŸ¥è¯¢æ•°ï¼Œåæ˜ æ•°æ®åº“è´Ÿè½½</li></ul><h3 id="è¿æ¥æ± æŒ‡æ ‡" tabindex="-1">è¿æ¥æ± æŒ‡æ ‡ <a class="header-anchor" href="#è¿æ¥æ± æŒ‡æ ‡" aria-label="Permalink to â€œè¿æ¥æ± æŒ‡æ ‡â€">â€‹</a></h3><ul><li><strong>æ´»è·ƒè¿æ¥æ•°</strong>: å½“å‰æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„è¿æ¥æ•°é‡</li><li><strong>è¿æ¥ä½¿ç”¨ç‡</strong>: æ´»è·ƒè¿æ¥å æ€»è¿æ¥æ•°çš„æ¯”ä¾‹</li><li><strong>æœ€å¤§è¿æ¥æ•°</strong>: å†å²æœ€é«˜è¿æ¥ä½¿ç”¨é‡</li></ul><h3 id="æ…¢æŸ¥è¯¢åˆ†æè¦ç‚¹" tabindex="-1">æ…¢æŸ¥è¯¢åˆ†æè¦ç‚¹ <a class="header-anchor" href="#æ…¢æŸ¥è¯¢åˆ†æè¦ç‚¹" aria-label="Permalink to â€œæ…¢æŸ¥è¯¢åˆ†æè¦ç‚¹â€">â€‹</a></h3><ul><li><strong>æ‰§è¡Œæ—¶é—´</strong>: è¯†åˆ«æœ€è€—æ—¶çš„æŸ¥è¯¢</li><li><strong>é”ç­‰å¾…æ—¶é—´</strong>: åˆ†æå¹¶å‘æ€§èƒ½é—®é¢˜</li><li><strong>æ‰«æè¡Œæ•°</strong>: è¯†åˆ«å…¨è¡¨æ‰«æç­‰ä½æ•ˆæŸ¥è¯¢</li><li><strong>è¿”å›è¡Œæ•°</strong>: åˆ†ææŸ¥è¯¢æ•ˆç‡</li></ul><h2 id="æœ€ä½³å®è·µ" tabindex="-1">æœ€ä½³å®è·µ <a class="header-anchor" href="#æœ€ä½³å®è·µ" aria-label="Permalink to â€œæœ€ä½³å®è·µâ€">â€‹</a></h2><h3 id="_1-å®šæœŸç›‘æ§" tabindex="-1">1. å®šæœŸç›‘æ§ <a class="header-anchor" href="#_1-å®šæœŸç›‘æ§" aria-label="Permalink to â€œ1. å®šæœŸç›‘æ§â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> setup_performance_monitoring</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">è®¾ç½®æ€§èƒ½ç›‘æ§ä»»åŠ¡</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    import</span><span style="color:#BABED8;"> schedule</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#C792EA;">    def</span><span style="color:#82AAFF;"> daily_performance_check</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#82AAFF;">        analyze_slow_queries</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        monitor_query_performance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ¯å¤©ä¸Šåˆ9ç‚¹æ‰§è¡Œæ€§èƒ½æ£€æŸ¥</span></span>
<span class="line"><span style="color:#BABED8;">    schedule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">every</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">day</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">at</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">09:00</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">do</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">daily_performance_check</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ¯å°æ—¶æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥</span></span>
<span class="line"><span style="color:#BABED8;">    schedule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">every</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">hour</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">do</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#C792EA;">        lambda</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> monitor_query_performance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 5.0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-æ€§èƒ½ä¼˜åŒ–å»ºè®®ç”Ÿæˆ" tabindex="-1">2. æ€§èƒ½ä¼˜åŒ–å»ºè®®ç”Ÿæˆ <a class="header-anchor" href="#_2-æ€§èƒ½ä¼˜åŒ–å»ºè®®ç”Ÿæˆ" aria-label="Permalink to â€œ2. æ€§èƒ½ä¼˜åŒ–å»ºè®®ç”Ÿæˆâ€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> generate_optimization_suggestions</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">ç”ŸæˆæŸ¥è¯¢ä¼˜åŒ–å»ºè®®</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    suggestions </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    for</span><span style="color:#BABED8;"> query </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">slow_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> []):</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        # åˆ†ææ‰«ææ•ˆç‡</span></span>
<span class="line"><span style="color:#BABED8;">        scan_efficiency </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rows_sent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> /</span><span style="color:#BABED8;"> query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rows_examined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;font-style:italic;"> if</span><span style="color:#BABED8;"> query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rows_examined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;font-style:italic;"> else</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        if</span><span style="color:#BABED8;"> scan_efficiency </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;"> 0.01</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">            suggestions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#C792EA;">                f</span><span style="color:#C3E88D;">&quot;æŸ¥è¯¢æ‰«ææ•ˆç‡ä½ (</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">scan_efficiency</span><span style="color:#C792EA;">:.2%</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">)ï¼Œè€ƒè™‘æ·»åŠ ç´¢å¼•: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sql_text</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][:</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">...&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">            )</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        if</span><span style="color:#BABED8;"> query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lock_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#F78C6C;"> 0.1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">            suggestions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#C792EA;">                f</span><span style="color:#C3E88D;">&quot;æŸ¥è¯¢é”ç­‰å¾…æ—¶é—´è¾ƒé•¿ (</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lock_time</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#C792EA;">:.3f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">s)ï¼Œè€ƒè™‘ä¼˜åŒ–äº‹åŠ¡: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sql_text</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][:</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">...&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">            )</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> suggestions</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-å®¹é‡è§„åˆ’" tabindex="-1">3. å®¹é‡è§„åˆ’ <a class="header-anchor" href="#_3-å®¹é‡è§„åˆ’" aria-label="Permalink to â€œ3. å®¹é‡è§„åˆ’â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> query_capacity_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> db_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">æŸ¥è¯¢å®¹é‡åˆ†æ</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> get_query_analysis</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">api_key</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> db_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    query_stats </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query_stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#BABED8;">    total_queries </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">total_queries</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    qps </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> query_stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">queries_per_second</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ“‹ æŸ¥è¯¢å®¹é‡åˆ†æ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   å½“å‰ QPS: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">qps</span><span style="color:#C792EA;">:.1f</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;   æ—¥å‡æŸ¥è¯¢é‡: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">total_queries</span><span style="color:#C792EA;">:,</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # åŸºäºå½“å‰è´Ÿè½½çš„å®¹é‡å»ºè®®</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> qps </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> 100</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ’¡ å»ºè®®: å½“å‰è´Ÿè½½è¾ƒé«˜ï¼Œè€ƒè™‘è¯»å†™åˆ†ç¦»</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    elif</span><span style="color:#BABED8;"> qps </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> 50</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ’¡ å»ºè®®: è´Ÿè½½é€‚ä¸­ï¼Œå®šæœŸç›‘æ§æ€§èƒ½</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#82AAFF;">        print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸ’¡ å»ºè®®: è´Ÿè½½è¾ƒä½ï¼Œç³»ç»Ÿè¿è¡Œè‰¯å¥½</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="ç›¸å…³é“¾æ¥" tabindex="-1">ç›¸å…³é“¾æ¥ <a class="header-anchor" href="#ç›¸å…³é“¾æ¥" aria-label="Permalink to â€œç›¸å…³é“¾æ¥â€">â€‹</a></h2><ul><li><a href="./../monitoring-stats/">ç›‘æ§ç»Ÿè®¡æ€»è§ˆ</a></li><li><a href="./../monitoring-stats/database-stats">æ•°æ®åº“ç»Ÿè®¡</a></li><li><a href="./../monitoring-stats/performance-stats">æ€§èƒ½ç»Ÿè®¡</a></li><li><a href="./../monitoring-stats/api-usage-stats">API ä½¿ç”¨ç»Ÿè®¡</a></li></ul>`,50))])}const E=p(F,[["render",D]]);export{C as __pageData,E as default};
