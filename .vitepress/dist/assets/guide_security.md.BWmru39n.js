import{_ as a,c as n,o as l,aj as p}from"./chunks/framework.e3UxQEvm.js";const y=JSON.parse('{"title":"å®‰å…¨æŒ‡å—","description":"","frontmatter":{},"headers":[],"relativePath":"guide/security.md","filePath":"guide/security.md","lastUpdated":0}'),o={name:"guide/security.md"};function e(r,s,t,c,i,F){return l(),n("div",null,[...s[0]||(s[0]=[p(`<h1 id="å®‰å…¨æŒ‡å—" tabindex="-1">å®‰å…¨æŒ‡å— <a class="header-anchor" href="#å®‰å…¨æŒ‡å—" aria-label="Permalink to â€œå®‰å…¨æŒ‡å—â€">â€‹</a></h1><h2 id="æ¦‚è¿°" tabindex="-1">æ¦‚è¿° <a class="header-anchor" href="#æ¦‚è¿°" aria-label="Permalink to â€œæ¦‚è¿°â€">â€‹</a></h2><p>æœ¬æ–‡æ¡£æä¾›æ•°æ®åº“ç®¡ç† API çš„å®‰å…¨é…ç½®ã€æœ€ä½³å®è·µå’Œé£é™©é˜²èŒƒæŒ‡å—ï¼Œå¸®åŠ©æ‚¨å®‰å…¨åœ°éƒ¨ç½²å’Œä½¿ç”¨ API æœåŠ¡ã€‚</p><h2 id="è®¤è¯å®‰å…¨" tabindex="-1">è®¤è¯å®‰å…¨ <a class="header-anchor" href="#è®¤è¯å®‰å…¨" aria-label="Permalink to â€œè®¤è¯å®‰å…¨â€">â€‹</a></h2><h3 id="api-å¯†é’¥ç®¡ç†" tabindex="-1">API å¯†é’¥ç®¡ç† <a class="header-anchor" href="#api-å¯†é’¥ç®¡ç†" aria-label="Permalink to â€œAPI å¯†é’¥ç®¡ç†â€">â€‹</a></h3><h4 id="å¯†é’¥ç”Ÿæˆä¸å­˜å‚¨" tabindex="-1">å¯†é’¥ç”Ÿæˆä¸å­˜å‚¨ <a class="header-anchor" href="#å¯†é’¥ç”Ÿæˆä¸å­˜å‚¨" aria-label="Permalink to â€œå¯†é’¥ç”Ÿæˆä¸å­˜å‚¨â€">â€‹</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># API å¯†é’¥ä½¿ç”¨åŠ å¯†å®‰å…¨éšæœºæ•°ç”Ÿæˆ</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> generate_api_key</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">ç”ŸæˆAPIå¯†é’¥</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> secrets</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">token_urlsafe</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">32</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">  # 256ä½å®‰å…¨éšæœºæ•°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>å®‰å…¨è¦æ±‚ï¼š</strong></p><ul><li>ğŸ”‘ <strong>å¯†é’¥é•¿åº¦</strong>: æœ€å° 32 å­—ç¬¦</li><li>ğŸ”„ <strong>éšæœºæ€§</strong>: ä½¿ç”¨åŠ å¯†å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨</li><li>ğŸ’¾ <strong>å­˜å‚¨</strong>: æ•°æ®åº“ä¸­åŠ å¯†å­˜å‚¨</li><li>ğŸ—‘ï¸ <strong>ç”Ÿå‘½å‘¨æœŸ</strong>: æ”¯æŒå¯†é’¥æ’¤é”€å’Œè¿‡æœŸ</li></ul><h4 id="å¯†é’¥ä½¿ç”¨è§„èŒƒ" tabindex="-1">å¯†é’¥ä½¿ç”¨è§„èŒƒ <a class="header-anchor" href="#å¯†é’¥ä½¿ç”¨è§„èŒƒ" aria-label="Permalink to â€œå¯†é’¥ä½¿ç”¨è§„èŒƒâ€">â€‹</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æ­£ç¡®ç”¨æ³• - ä½¿ç”¨ Bearer Token</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -H</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Authorization: Bearer your_api_key_here</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># é”™è¯¯ç”¨æ³• - ç›´æ¥æš´éœ²åœ¨URLä¸­</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> http://api.com/endpoint?api_key=xxx</span><span style="color:#676E95;font-style:italic;">  # âŒ ä¸å®‰å…¨ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="å¯†ç å®‰å…¨" tabindex="-1">å¯†ç å®‰å…¨ <a class="header-anchor" href="#å¯†ç å®‰å…¨" aria-label="Permalink to â€œå¯†ç å®‰å…¨â€">â€‹</a></h3><h4 id="å¯†ç å“ˆå¸Œ" tabindex="-1">å¯†ç å“ˆå¸Œ <a class="header-anchor" href="#å¯†ç å“ˆå¸Œ" aria-label="Permalink to â€œå¯†ç å“ˆå¸Œâ€">â€‹</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> hash_password</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> password</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">å“ˆå¸Œå¯†ç ï¼ˆåŠ ç›ï¼‰</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    salt </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">database_api_salt_2024</span><span style="color:#89DDFF;">&quot;</span><span style="color:#676E95;font-style:italic;">  # ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨éšæœºç›</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> hashlib</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sha256</span><span style="color:#89DDFF;">((</span><span style="color:#82AAFF;">password </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> salt</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">()).</span><span style="color:#82AAFF;">hexdigest</span><span style="color:#89DDFF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>å¯†ç ç­–ç•¥ï¼š</strong></p><ul><li>âœ… æœ€å°é•¿åº¦ï¼š6 å­—ç¬¦</li><li>âœ… å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—</li><li>âŒ ç¦æ­¢ä½¿ç”¨å¸¸è§å¼±å¯†ç </li><li>ğŸ”„ æ”¯æŒå®šæœŸå¯†ç æ›´æ¢</li></ul><h2 id="æƒé™å®‰å…¨" tabindex="-1">æƒé™å®‰å…¨ <a class="header-anchor" href="#æƒé™å®‰å…¨" aria-label="Permalink to â€œæƒé™å®‰å…¨â€">â€‹</a></h2><h3 id="åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶-rbac" tabindex="-1">åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) <a class="header-anchor" href="#åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶-rbac" aria-label="Permalink to â€œåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)â€">â€‹</a></h3><h4 id="æƒé™çº§åˆ«å®šä¹‰" tabindex="-1">æƒé™çº§åˆ«å®šä¹‰ <a class="header-anchor" href="#æƒé™çº§åˆ«å®šä¹‰" aria-label="Permalink to â€œæƒé™çº§åˆ«å®šä¹‰â€">â€‹</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#BABED8;">PERMISSION_LEVELS </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">readonly</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">      # åªè¯»æƒé™</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">operator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">      # æ“ä½œæƒé™ï¼ˆæŸ¥è¯¢ã€æ’å…¥ï¼‰</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 3</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">         # ç®¡ç†å‘˜æƒé™ï¼ˆå…¨éƒ¨æ“ä½œï¼‰</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">superadmin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 4</span><span style="color:#676E95;font-style:italic;">     # è¶…çº§ç®¡ç†å‘˜ï¼ˆåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ï¼‰</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="æƒé™éªŒè¯è£…é¥°å™¨" tabindex="-1">æƒé™éªŒè¯è£…é¥°å™¨ <a class="header-anchor" href="#æƒé™éªŒè¯è£…é¥°å™¨" aria-label="Permalink to â€œæƒé™éªŒè¯è£…é¥°å™¨â€">â€‹</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> require_permission</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">permission_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">è¦æ±‚ç‰¹å®šæƒé™çš„è£…é¥°å™¨</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C792EA;">    def</span><span style="color:#82AAFF;"> decorator</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">f</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;">        @</span><span style="color:#82AAFF;">wraps</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">f</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">        @</span><span style="color:#82AAFF;">require_auth</span></span>
<span class="line"><span style="color:#C792EA;">        def</span><span style="color:#82AAFF;"> decorated_function</span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> **</span><span style="color:#BABED8;font-style:italic;">kwargs</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">            user_info </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> getattr</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">request</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {})</span></span>
<span class="line"><span style="color:#BABED8;">            user_permissions </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> user_info</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">permissions</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> [])</span></span>
<span class="line"><span style="color:#BABED8;">            </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            # è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">            if</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">all</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> in</span><span style="color:#BABED8;"> user_permissions</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">                return</span><span style="color:#82AAFF;"> f</span><span style="color:#89DDFF;">(*</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> **</span><span style="color:#82AAFF;">kwargs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">            </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            # æ£€æŸ¥æƒé™</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">            if</span><span style="color:#BABED8;"> permission_name </span><span style="color:#89DDFF;">not</span><span style="color:#89DDFF;"> in</span><span style="color:#BABED8;"> user_permissions</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">                return</span><span style="color:#82AAFF;"> jsonify</span><span style="color:#89DDFF;">({</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">æƒé™ä¸è¶³</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}),</span><span style="color:#F78C6C;"> 403</span></span>
<span class="line"><span style="color:#BABED8;">            </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">            return</span><span style="color:#82AAFF;"> f</span><span style="color:#89DDFF;">(*</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> **</span><span style="color:#82AAFF;">kwargs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#BABED8;"> decorated_function</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> decorator</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="æ•°æ®åº“æƒé™éš”ç¦»" tabindex="-1">æ•°æ®åº“æƒé™éš”ç¦» <a class="header-anchor" href="#æ•°æ®åº“æƒé™éš”ç¦»" aria-label="Permalink to â€œæ•°æ®åº“æƒé™éš”ç¦»â€">â€‹</a></h3><h4 id="æƒé™æ£€æŸ¥æœºåˆ¶" tabindex="-1">æƒé™æ£€æŸ¥æœºåˆ¶ <a class="header-anchor" href="#æƒé™æ£€æŸ¥æœºåˆ¶" aria-label="Permalink to â€œæƒé™æ£€æŸ¥æœºåˆ¶â€">â€‹</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> check_database_permission</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> user_id</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> database_name</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> required_permission</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">read</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FFCB6B;"> bool</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">æ£€æŸ¥ç”¨æˆ·å¯¹æ•°æ®åº“çš„æƒé™</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 1. éªŒè¯ç”¨æˆ·è§’è‰²</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 2. æ£€æŸ¥æ•°æ®åº“çº§æƒé™</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 3. éªŒè¯æƒé™çº§åˆ«</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æƒé™çº§åˆ«æ˜ å°„ï¼š</strong></p><ul><li><code>read</code> â†’ æŸ¥è¯¢æ“ä½œ</li><li><code>write</code> â†’ æ’å…¥ã€æ›´æ–°ã€åˆ é™¤</li><li><code>admin</code> â†’ è¡¨ç»“æ„ä¿®æ”¹ã€å¤‡ä»½æ“ä½œ</li></ul><h2 id="è¾“å…¥éªŒè¯ä¸-sql-æ³¨å…¥é˜²æŠ¤" tabindex="-1">è¾“å…¥éªŒè¯ä¸ SQL æ³¨å…¥é˜²æŠ¤ <a class="header-anchor" href="#è¾“å…¥éªŒè¯ä¸-sql-æ³¨å…¥é˜²æŠ¤" aria-label="Permalink to â€œè¾“å…¥éªŒè¯ä¸ SQL æ³¨å…¥é˜²æŠ¤â€">â€‹</a></h2><h3 id="æ•°æ®åº“åç§°éªŒè¯" tabindex="-1">æ•°æ®åº“åç§°éªŒè¯ <a class="header-anchor" href="#æ•°æ®åº“åç§°éªŒè¯" aria-label="Permalink to â€œæ•°æ®åº“åç§°éªŒè¯â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> validate_database_name</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">db_name</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FFCB6B;"> bool</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">éªŒè¯æ•°æ®åº“åç§°æ ¼å¼</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#89DDFF;"> not</span><span style="color:#BABED8;"> db_name </span><span style="color:#89DDFF;">or</span><span style="color:#89DDFF;"> not</span><span style="color:#82AAFF;"> isinstance</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">db_name</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> False</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # å…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œä¸”ä¸èƒ½æ˜¯çº¯æ•°å­—</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> db_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">isalnum</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> and</span><span style="color:#89DDFF;"> not</span><span style="color:#BABED8;"> db_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isdigit</span><span style="color:#89DDFF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="sql-æŸ¥è¯¢å®‰å…¨éªŒè¯" tabindex="-1">SQL æŸ¥è¯¢å®‰å…¨éªŒè¯ <a class="header-anchor" href="#sql-æŸ¥è¯¢å®‰å…¨éªŒè¯" aria-label="Permalink to â€œSQL æŸ¥è¯¢å®‰å…¨éªŒè¯â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> validate_sql_security</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">sql</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> query_type</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FFCB6B;"> dict</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">éªŒè¯SQLè¯­å¥çš„å®‰å…¨æ€§</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # ç¦æ­¢çš„SQLå…³é”®å­—ï¼ˆå†™æ“ä½œï¼‰</span></span>
<span class="line"><span style="color:#BABED8;">    forbidden_keywords </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">        &#39;</span><span style="color:#C3E88D;">INSERT</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">UPDATE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">DELETE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">DROP</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">TRUNCATE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">CREATE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">        &#39;</span><span style="color:#C3E88D;">ALTER</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">GRANT</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">REVOKE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">REPLACE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">MERGE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">LOCK</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">UNLOCK</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">    ]</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ£€æŸ¥æ˜¯å¦åŒ…å«ç¦æ­¢çš„å…³é”®å­—</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    for</span><span style="color:#BABED8;"> keyword </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> forbidden_keywords</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        if</span><span style="color:#C792EA;"> f</span><span style="color:#C3E88D;">&#39; </span><span style="color:#F78C6C;">{</span><span style="color:#BABED8;">keyword</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> &#39;</span><span style="color:#89DDFF;"> in</span><span style="color:#C792EA;"> f</span><span style="color:#C3E88D;">&#39; </span><span style="color:#F78C6C;">{</span><span style="color:#BABED8;">sql_upper</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> &#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">            return</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">                &#39;</span><span style="color:#C3E88D;">valid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> False,</span></span>
<span class="line"><span style="color:#89DDFF;">                &#39;</span><span style="color:#C3E88D;">reason</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;"> f</span><span style="color:#C3E88D;">&#39;æ£€æµ‹åˆ°ç¦æ­¢çš„æ“ä½œ: </span><span style="color:#F78C6C;">{</span><span style="color:#BABED8;">keyword</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">            }</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # é™åˆ¶æŸ¥è¯¢é•¿åº¦å’Œå¤æ‚åº¦</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#82AAFF;"> len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sql</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#F78C6C;"> 5000</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> {</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">valid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> False,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">reason</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">SQLè¯­å¥è¿‡é•¿</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">valid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> True}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="å‚æ•°åŒ–æŸ¥è¯¢" tabindex="-1">å‚æ•°åŒ–æŸ¥è¯¢ <a class="header-anchor" href="#å‚æ•°åŒ–æŸ¥è¯¢" aria-label="Permalink to â€œå‚æ•°åŒ–æŸ¥è¯¢â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å®‰å…¨ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#BABED8;">cursor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SELECT * FROM users WHERE name = </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;"> AND age &gt; </span><span style="color:#F78C6C;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> (</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> min_age</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆå®¹æ˜“SQLæ³¨å…¥ï¼‰</span></span>
<span class="line"><span style="color:#BABED8;">cursor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;SELECT * FROM users WHERE name = &#39;</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">name</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">  # âŒ ä¸å®‰å…¨ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="é€Ÿç‡é™åˆ¶" tabindex="-1">é€Ÿç‡é™åˆ¶ <a class="header-anchor" href="#é€Ÿç‡é™åˆ¶" aria-label="Permalink to â€œé€Ÿç‡é™åˆ¶â€">â€‹</a></h2><h3 id="å…¨å±€é™æµé…ç½®" tabindex="-1">å…¨å±€é™æµé…ç½® <a class="header-anchor" href="#å…¨å±€é™æµé…ç½®" aria-label="Permalink to â€œå…¨å±€é™æµé…ç½®â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#BABED8;">limiter </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> Limiter</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    get_remote_address</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic;">    app</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic;">    default_limits</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">200 per day</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">50 per hour</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic;">    storage_uri</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">memory://</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="ç«¯ç‚¹çº§é™æµ" tabindex="-1">ç«¯ç‚¹çº§é™æµ <a class="header-anchor" href="#ç«¯ç‚¹çº§é™æµ" aria-label="Permalink to â€œç«¯ç‚¹çº§é™æµâ€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/create</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> methods</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">limiter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">limit</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10 per minute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">  # åˆ›å»ºæ•°æ®åº“é¢‘ç‡é™åˆ¶</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> create_database</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/database/&lt;db_name&gt;/backup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> methods</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">limiter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">limit</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3 per hour</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">  # å¤‡ä»½æ“ä½œé¢‘ç‡é™åˆ¶</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> backup_database</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">db_name</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="é™æµç­–ç•¥" tabindex="-1">é™æµç­–ç•¥ <a class="header-anchor" href="#é™æµç­–ç•¥" aria-label="Permalink to â€œé™æµç­–ç•¥â€">â€‹</a></h3><table tabindex="0"><thead><tr><th>ç«¯ç‚¹</th><th>é™åˆ¶è§„åˆ™</th><th>ç›®çš„</th></tr></thead><tbody><tr><td>ç”¨æˆ·æ³¨å†Œ</td><td>5/å°æ—¶</td><td>é˜²æ­¢æ‰¹é‡æ³¨å†Œ</td></tr><tr><td>æ•°æ®åº“åˆ›å»º</td><td>10/åˆ†é’Ÿ</td><td>é˜²æ­¢èµ„æºæ»¥ç”¨</td></tr><tr><td>å¤‡ä»½æ“ä½œ</td><td>3/å°æ—¶</td><td>é˜²æ­¢ç³»ç»Ÿè¿‡è½½</td></tr><tr><td>æ•°æ®å¯¼å‡º</td><td>10/å°æ—¶</td><td>ä¿æŠ¤æ•°æ®å®‰å…¨</td></tr><tr><td>SQL æŸ¥è¯¢</td><td>50/å°æ—¶</td><td>é˜²æ­¢æ•°æ®åº“è¿‡è½½</td></tr></tbody></table><h2 id="æ•°æ®ä¿æŠ¤" tabindex="-1">æ•°æ®ä¿æŠ¤ <a class="header-anchor" href="#æ•°æ®ä¿æŠ¤" aria-label="Permalink to â€œæ•°æ®ä¿æŠ¤â€">â€‹</a></h2><h3 id="æ•æ„Ÿæ•°æ®è„±æ•" tabindex="-1">æ•æ„Ÿæ•°æ®è„±æ• <a class="header-anchor" href="#æ•æ„Ÿæ•°æ®è„±æ•" aria-label="Permalink to â€œæ•æ„Ÿæ•°æ®è„±æ•â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># åœ¨æ—¥å¿—ä¸­è„±æ•æ•æ„Ÿä¿¡æ¯</span></span>
<span class="line"><span style="color:#BABED8;">safe_sql </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> sql</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">\\r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">strip</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#82AAFF;"> len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">safe_sql</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#F78C6C;"> 200</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    safe_sql </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> safe_sql</span><span style="color:#89DDFF;">[:</span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> +</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;SQLæŸ¥è¯¢æ‰§è¡ŒæˆåŠŸ: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">db_name</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">, ç±»å‹: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">query_type</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">, è¿”å›è¡Œæ•°: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="é”™è¯¯ä¿¡æ¯å¤„ç†" tabindex="-1">é”™è¯¯ä¿¡æ¯å¤„ç† <a class="header-anchor" href="#é”™è¯¯ä¿¡æ¯å¤„ç†" aria-label="Permalink to â€œé”™è¯¯ä¿¡æ¯å¤„ç†â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # æ•°æ®åº“æ“ä½œ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">except</span><span style="color:#BABED8;"> pymysql</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Error</span><span style="color:#89DDFF;font-style:italic;"> as</span><span style="color:#BABED8;"> e</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # å¯¹é”™è¯¯ä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†</span></span>
<span class="line"><span style="color:#BABED8;">    safe_error </span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;"> f</span><span style="color:#C3E88D;">&#39;SQLæ‰§è¡Œé”™è¯¯ (é”™è¯¯ä»£ç : </span><span style="color:#F78C6C;">{</span><span style="color:#BABED8;">error_code</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">)&#39;</span></span>
<span class="line"><span style="color:#BABED8;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;SQLæ‰§è¡Œå¤±è´¥: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">error_code</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> - </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">error_message</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#82AAFF;"> jsonify</span><span style="color:#89DDFF;">({</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> safe_error</span><span style="color:#89DDFF;">}),</span><span style="color:#F78C6C;"> 400</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="å®¡è®¡ä¸æ—¥å¿—" tabindex="-1">å®¡è®¡ä¸æ—¥å¿— <a class="header-anchor" href="#å®¡è®¡ä¸æ—¥å¿—" aria-label="Permalink to â€œå®¡è®¡ä¸æ—¥å¿—â€">â€‹</a></h2><h3 id="æ“ä½œå®¡è®¡" tabindex="-1">æ“ä½œå®¡è®¡ <a class="header-anchor" href="#æ“ä½œå®¡è®¡" aria-label="Permalink to â€œæ“ä½œå®¡è®¡â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> log_audit</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> user_id</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> action</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> resource</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> None,</span><span style="color:#BABED8;font-style:italic;"> details</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;"> str</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> None):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">è®°å½•å®¡è®¡æ—¥å¿—</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    ip_address </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">remote_addr</span></span>
<span class="line"><span style="color:#BABED8;">    user_agent </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">User-Agent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    cursor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">        INSERT INTO audit_logs (user_id, action, resource, details, ip_address, user_agent)</span></span>
<span class="line"><span style="color:#C3E88D;">        VALUES (</span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">, </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">, </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">, </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">, </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">, </span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;&quot;&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> (</span><span style="color:#82AAFF;">user_id</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> action</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> resource</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> details</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> ip_address</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> user_agent</span><span style="color:#89DDFF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="å®¡è®¡æ—¥å¿—å†…å®¹" tabindex="-1">å®¡è®¡æ—¥å¿—å†…å®¹ <a class="header-anchor" href="#å®¡è®¡æ—¥å¿—å†…å®¹" aria-label="Permalink to â€œå®¡è®¡æ—¥å¿—å†…å®¹â€">â€‹</a></h3><ul><li>ğŸ‘¤ ç”¨æˆ·èº«ä»½ä¿¡æ¯</li><li>â° æ“ä½œæ—¶é—´æˆ³</li><li>ğŸ¯ æ“ä½œç±»å‹å’Œèµ„æº</li><li>ğŸŒ å®¢æˆ·ç«¯ IP å’Œ User-Agent</li><li>ğŸ“ æ“ä½œè¯¦æƒ…ï¼ˆè„±æ•åï¼‰</li></ul><h2 id="ç½‘ç»œå®‰å…¨" tabindex="-1">ç½‘ç»œå®‰å…¨ <a class="header-anchor" href="#ç½‘ç»œå®‰å…¨" aria-label="Permalink to â€œç½‘ç»œå®‰å…¨â€">â€‹</a></h2><h3 id="cors-é…ç½®" tabindex="-1">CORS é…ç½® <a class="header-anchor" href="#cors-é…ç½®" aria-label="Permalink to â€œCORS é…ç½®â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> flask_cors </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> CORS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> Flask</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">__name__</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">CORS</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">  # å…è®¸è·¨åŸŸè¯·æ±‚ï¼Œç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶åŸŸå</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®ï¼š</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#82AAFF;">CORS</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> origins</span><span style="color:#89DDFF;">=[</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#C3E88D;">https://your-frontend-domain.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#C3E88D;">https://admin.your-domain.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="è¯·æ±‚å¤´å®‰å…¨" tabindex="-1">è¯·æ±‚å¤´å®‰å…¨ <a class="header-anchor" href="#è¯·æ±‚å¤´å®‰å…¨" aria-label="Permalink to â€œè¯·æ±‚å¤´å®‰å…¨â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">after_request</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> apply_security_headers</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">response</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">åº”ç”¨å®‰å…¨å¤´éƒ¨</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    response</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Content-Type-Options</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">nosniff</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">    response</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Frame-Options</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">DENY</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">    response</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-XSS-Protection</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">1; mode=block</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> response</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="éƒ¨ç½²å®‰å…¨" tabindex="-1">éƒ¨ç½²å®‰å…¨ <a class="header-anchor" href="#éƒ¨ç½²å®‰å…¨" aria-label="Permalink to â€œéƒ¨ç½²å®‰å…¨â€">â€‹</a></h2><h3 id="ç¯å¢ƒé…ç½®" tabindex="-1">ç¯å¢ƒé…ç½® <a class="header-anchor" href="#ç¯å¢ƒé…ç½®" aria-label="Permalink to â€œç¯å¢ƒé…ç½®â€">â€‹</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># api.env - ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#BABED8;">DB_HOST</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql.internal.company.com</span></span>
<span class="line"><span style="color:#BABED8;">DB_USER</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">api_service_user</span></span>
<span class="line"><span style="color:#BABED8;">DB_PASSWORD</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">strong_password_123</span></span>
<span class="line"><span style="color:#BABED8;">DB_PORT</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">3306</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å®‰å…¨ç›¸å…³é…ç½®</span></span>
<span class="line"><span style="color:#BABED8;">SECRET_KEY</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">your_very_long_random_secret_key</span></span>
<span class="line"><span style="color:#BABED8;">BACKUP_DIR</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/secure/backup/location</span></span>
<span class="line"><span style="color:#BABED8;">LOG_LEVEL</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">WARNING</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="æ–‡ä»¶æƒé™" tabindex="-1">æ–‡ä»¶æƒé™ <a class="header-anchor" href="#æ–‡ä»¶æƒé™" aria-label="Permalink to â€œæ–‡ä»¶æƒé™â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å¤‡ä»½ç›®å½•å®‰å…¨é…ç½®</span></span>
<span class="line"><span style="color:#BABED8;">BACKUP_CONFIG </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">backup_dir</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">backups</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">max_backup_files</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 10</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &#39;</span><span style="color:#C3E88D;">backup_timeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 300</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ç¡®ä¿å¤‡ä»½ç›®å½•æƒé™æ­£ç¡®</span></span>
<span class="line"><span style="color:#BABED8;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">makedirs</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">BACKUP_CONFIG</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">backup_dir</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">],</span><span style="color:#BABED8;font-style:italic;"> exist_ok</span><span style="color:#89DDFF;">=True)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="ç›‘æ§ä¸å‘Šè­¦" tabindex="-1">ç›‘æ§ä¸å‘Šè­¦ <a class="header-anchor" href="#ç›‘æ§ä¸å‘Šè­¦" aria-label="Permalink to â€œç›‘æ§ä¸å‘Šè­¦â€">â€‹</a></h2><h3 id="å®‰å…¨äº‹ä»¶ç›‘æ§" tabindex="-1">å®‰å…¨äº‹ä»¶ç›‘æ§ <a class="header-anchor" href="#å®‰å…¨äº‹ä»¶ç›‘æ§" aria-label="Permalink to â€œå®‰å…¨äº‹ä»¶ç›‘æ§â€">â€‹</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ç›‘æ§å¼‚å¸¸ç™»å½•å°è¯•</span></span>
<span class="line"><span style="color:#BABED8;">failed_attempts </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">MAX_FAILED_ATTEMPTS </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> check_login_security</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">username</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> ip_address</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    &quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">æ£€æŸ¥ç™»å½•å®‰å…¨</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C792EA;">    global</span><span style="color:#BABED8;"> failed_attempts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#BABED8;"> failed_attempts </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#BABED8;"> MAX_FAILED_ATTEMPTS</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        app</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">warning</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;å¤šæ¬¡ç™»å½•å¤±è´¥: </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">username</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> from </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">ip_address</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        # è§¦å‘å‘Šè­¦æˆ–ä¸´æ—¶å°ç¦</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="å…³é”®æŒ‡æ ‡ç›‘æ§" tabindex="-1">å…³é”®æŒ‡æ ‡ç›‘æ§ <a class="header-anchor" href="#å…³é”®æŒ‡æ ‡ç›‘æ§" aria-label="Permalink to â€œå…³é”®æŒ‡æ ‡ç›‘æ§â€">â€‹</a></h3><ul><li>ğŸ” è®¤è¯å¤±è´¥æ¬¡æ•°</li><li>ğŸš« æƒé™æ‹’ç»æ¬¡æ•°</li><li>âš¡ é€Ÿç‡é™åˆ¶è§¦å‘</li><li>ğŸ“Š å¼‚å¸¸æ“ä½œæ¨¡å¼</li><li>ğŸ’¾ å¤‡ä»½æ“ä½œçŠ¶æ€</li></ul><h2 id="åº”æ€¥å“åº”" tabindex="-1">åº”æ€¥å“åº” <a class="header-anchor" href="#åº”æ€¥å“åº”" aria-label="Permalink to â€œåº”æ€¥å“åº”â€">â€‹</a></h2><h3 id="å®‰å…¨äº‹ä»¶å¤„ç†æµç¨‹" tabindex="-1">å®‰å…¨äº‹ä»¶å¤„ç†æµç¨‹ <a class="header-anchor" href="#å®‰å…¨äº‹ä»¶å¤„ç†æµç¨‹" aria-label="Permalink to â€œå®‰å…¨äº‹ä»¶å¤„ç†æµç¨‹â€">â€‹</a></h3><ol><li><p><strong>æ£€æµ‹</strong></p><ul><li>ç›‘æ§ç³»ç»Ÿå‘Šè­¦</li><li>å®¡è®¡æ—¥å¿—åˆ†æ</li><li>å¼‚å¸¸æ¨¡å¼è¯†åˆ«</li></ul></li><li><p><strong>å“åº”</strong></p><ul><li>ç«‹å³æ’¤é”€å—å½±å“å¯†é’¥</li><li>æš‚æ—¶ç¦ç”¨å¯ç–‘è´¦æˆ·</li><li>ä¿ç•™ç›¸å…³æ—¥å¿—è¯æ®</li></ul></li><li><p><strong>æ¢å¤</strong></p><ul><li>ä¿®å¤å®‰å…¨æ¼æ´</li><li>é‡ç½®å—å½±å“å‡­è¯</li><li>æ›´æ–°å®‰å…¨ç­–ç•¥</li></ul></li><li><p><strong>å¤ç›˜</strong></p><ul><li>åˆ†ææ ¹æœ¬åŸå› </li><li>æ”¹è¿›é˜²æŠ¤æªæ–½</li><li>æ›´æ–°åº”æ€¥é¢„æ¡ˆ</li></ul></li></ol><h3 id="ç´§æ€¥æ“ä½œå‘½ä»¤" tabindex="-1">ç´§æ€¥æ“ä½œå‘½ä»¤ <a class="header-anchor" href="#ç´§æ€¥æ“ä½œå‘½ä»¤" aria-label="Permalink to â€œç´§æ€¥æ“ä½œå‘½ä»¤â€">â€‹</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ç«‹å³æ’¤é”€æ‰€æœ‰æ´»è·ƒä¼šè¯</span></span>
<span class="line"><span style="color:#FFCB6B;">UPDATE</span><span style="color:#C3E88D;"> api_keys</span><span style="color:#C3E88D;"> SET</span><span style="color:#C3E88D;"> is_active</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> FALSE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ç¦ç”¨ç‰¹å®šç”¨æˆ·</span></span>
<span class="line"><span style="color:#FFCB6B;">UPDATE</span><span style="color:#C3E88D;"> users</span><span style="color:#C3E88D;"> SET</span><span style="color:#C3E88D;"> is_active</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> FALSE</span><span style="color:#C3E88D;"> WHERE</span><span style="color:#C3E88D;"> username</span><span style="color:#C3E88D;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">compromised_user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹æœ€è¿‘å®‰å…¨äº‹ä»¶</span></span>
<span class="line"><span style="color:#FFCB6B;">SELECT</span><span style="color:#BABED8;"> *</span><span style="color:#C3E88D;"> FROM</span><span style="color:#C3E88D;"> audit_logs</span><span style="color:#C3E88D;"> ORDER</span><span style="color:#C3E88D;"> BY</span><span style="color:#C3E88D;"> timestamp</span><span style="color:#C3E88D;"> DESC</span><span style="color:#C3E88D;"> LIMIT</span><span style="color:#F78C6C;"> 100</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="åˆè§„ä¸æœ€ä½³å®è·µ" tabindex="-1">åˆè§„ä¸æœ€ä½³å®è·µ <a class="header-anchor" href="#åˆè§„ä¸æœ€ä½³å®è·µ" aria-label="Permalink to â€œåˆè§„ä¸æœ€ä½³å®è·µâ€">â€‹</a></h2><h3 id="æ•°æ®ä¿æŠ¤æ³•è§„" tabindex="-1">æ•°æ®ä¿æŠ¤æ³•è§„ <a class="header-anchor" href="#æ•°æ®ä¿æŠ¤æ³•è§„" aria-label="Permalink to â€œæ•°æ®ä¿æŠ¤æ³•è§„â€">â€‹</a></h3><ul><li>ğŸ“œ <strong>æœ€å°æ•°æ®åŸåˆ™</strong>: åªæ”¶é›†å¿…è¦çš„æ•°æ®</li><li>ğŸ” <strong>åŠ å¯†å­˜å‚¨</strong>: æ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†</li><li>ğŸ—‘ï¸ <strong>æ•°æ®ä¿ç•™</strong>: å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®</li><li>ğŸ‘ï¸ <strong>è®¿é—®æ—¥å¿—</strong>: è®°å½•æ‰€æœ‰æ•°æ®è®¿é—®</li></ul><h3 id="å®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å•" tabindex="-1">å®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å• <a class="header-anchor" href="#å®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å•" aria-label="Permalink to â€œå®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å•â€">â€‹</a></h3><ul><li>[ ] å®¡æŸ¥ç”¨æˆ·æƒé™åˆ†é…</li><li>[ ] è½®æ¢ API å¯†é’¥å’Œå¯†ç </li><li>[ ] æ›´æ–°ä¾èµ–åŒ…å®‰å…¨è¡¥ä¸</li><li>[ ] æ£€æŸ¥å®¡è®¡æ—¥å¿—å¼‚å¸¸</li><li>[ ] éªŒè¯å¤‡ä»½å®Œæ•´æ€§</li><li>[ ] æµ‹è¯•åº”æ€¥å“åº”æµç¨‹</li></ul><h2 id="è·å–å¸®åŠ©" tabindex="-1">è·å–å¸®åŠ© <a class="header-anchor" href="#è·å–å¸®åŠ©" aria-label="Permalink to â€œè·å–å¸®åŠ©â€">â€‹</a></h2><p>å¦‚æœå‘ç°å®‰å…¨æ¼æ´æˆ–éœ€è¦å®‰å…¨æ”¯æŒï¼Œè¯·è”ç³»ï¼š</p><ul><li>ğŸ“§ å®‰å…¨å›¢é˜Ÿ: <a href="mailto:security@your-company.com" target="_blank" rel="noreferrer">security@your-company.com</a></li><li>ğŸ”” ç´§æ€¥äº‹ä»¶: +1-XXX-XXX-XXXX</li></ul><p><strong>é‡è¦</strong>: è¯·å‹¿åœ¨å…¬å¼€æ¸ é“æŠ«éœ²å®‰å…¨æ¼æ´ï¼Œé€šè¿‡å®‰å…¨æ¸ é“æŠ¥å‘Šã€‚</p>`,82)])])}const b=a(o,[["render",e]]);export{y as __pageData,b as default};
